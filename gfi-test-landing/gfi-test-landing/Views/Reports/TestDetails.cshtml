@model gfi_test_landing.Models.BuildTestsModel
@{
    ViewBag.Title = "TestDetaiLs";
}

<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>Test Details</h1>
                <h4> Id: @Model.Id </h4>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="/Home/MyProjects">Home</a></li>
                    <li class="breadcrumb-item"><a href="/Home/Builds">Builds List</a></li>
                    <li class="breadcrumb-item"><a href="/Home/BuildDetails?buildId=">Builds Details</a></li>
                    <li class="breadcrumb-item active">Test Details</li>
                </ol>
            </div>
        </div>
       
        @*<div class="row mb-2">
            <div class="col-sm-6">
               
            </div>
        </div>*@

    </div>
</section>

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-3 col-3">
                <div class="callout">
                    <h6 class="font-weight-bold"> Status:</h6>
                    @Model.Status
                </div>
            </div><!-- /.col -->
            <div class="col-3 col-3">
                <div class="callout">
                    <h6 class="font-weight-bold">Started at:</h6>
                    @Model.Date_start
                </div>
            </div><!-- /.col -->
            <div class="col-3 col-3">
                <div class="callout">
                    <h6 class="font-weight-bold">Ended at:</h6>
                    @Model.Date_end
                </div>
            </div>
            <div class="col-3 col-3">
                <div class="callout">
                    <h6 class="font-weight-bold"> Duration:</h6>
                    @Model.Duration
                </div>
            </div>
        </div>
    </div>
</section>

<section class="container-fluid">

    <div class="row">
        <!--Mini table-->
        <div class="col-md-12 col-sm-12">

            <div class="card">
                <!-- /.card-header -->
                <div class="card-body table-responsive p-0">

                    <table class="table table-hover">

                        <tbody>
                            <tr class="bg-secondary text-white">
                                <th colspan="2" class="font-weight-bold">
                                    More Information
                                </th>
                                @*<th style="font-weight:normal;">Machine Id: &nbsp;&nbsp;&nbsp; <span style="font-weight:bold;"> @Model.Id_machine</span></th>
                                    <th style="font-weight:normal;">Battery Test Id  &nbsp;&nbsp;&nbsp; <span style="font-weight:bold;"> @Model.Id_batteryTest</span></th>*@
                            </tr>
                            <tr>
                                <td><span class="tag tag-danger" style="font-weight:bold;">General Message:</span></td>
                                <td>@Model.General_message </td>
                            </tr>
                            <tr>
                                <td><span class="tag tag-danger" style="font-weight:bold;">Error Message:</span></td>
                                <td>@Model.Error_message </td>
                            </tr>
                            <tr>
                                <td><span class="tag tag-danger" style="font-weight:bold;">Test Name:</span></td>
                                <td> @Model.Name</td>
                            </tr>
                            <tr>
                                <td><span class="tag tag-danger" style="font-weight:bold;">Borwser:</span></td>
                                <td>@Model.Browser</td>
                            </tr>
                            <tr>
                                <td><span class="tag tag-danger" style="font-weight:bold;">Site:</span></td>
                                <td>@Model.Site</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- /.card-body -->
            </div>
        </div>
    </div>
</section>

<section class="content">
    <div class="row">
        <div class="col-12">
            <!-- /.card -->
            <div class="card">
                <div class="card-header">
                    <strong class="card-title">Step List</strong>
                </div>
                <div class="card-body">
                    <table id="tests-table" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Name</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                <th>Status</th>
                                <th>Duration</th>
                                @*<th>Description</th>
                                <th>Error_message</th>
                                <th>Screenshot</th>*@
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <!-- /.card -->
        </div>
    </div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

<script>

      //Init DataTable
    $.ajax({
        type: "GET",
        contentType: "application/json",
        dataType: "json",
        url: 'http://localhost:59443/api/GetBuildSteps/' + @Html.Raw(Model.Id),
        }).done(function (steps) {
            console.log(steps);
            steps.forEach(function (step) {

            setdatatablevalues(step.Id, step.Name, step.Data_start, step.Data_end,
                step.Status, step.Duration,
                step.Error_message, step.Description, step.Screenshot);
        });

        }).always(function () {
            //Init DataTable
            $("#tests-table").DataTable({
                scrollCollapse: true
            });

    });


    function setdatatablevalues(Id, Name, Date_start, Date_end, Status,
         Duration, 
        Error_message, Description, Screenshot) {

        var screenshots = '<a href="" target="blank"><i class="fa fa-image" style="font-size:24px;"></i></a>';
        var details = '<a href="http://localhost:54669/Reports/StepDetails?stepId=' + Id +
            '" target="blank"><i class="fa fa-share-square-o" style="font-size:24px; color:green"></i></a>';

        var row = '<tr>' +
        '<td>' + Id + '</td>' +
        '<td>' + Name + '</td>' +
        '<td>' + Date_start + '</td>' +
        '<td>' + Date_end + '</td>' +
        '<td>' + Status + '</td>' +
        '<td>' + Duration + '</td>' +
        //'<td>' + Description + '</td>' +
        //'<td>' + Error_message + '</td>' +
        //'<td>' + Screenshot + '</td>' +
        '<td>' + details + '</td>' +
            '</tr>';

        $('#tests-table').append(row);
    }

</script>